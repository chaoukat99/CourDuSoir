<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Todo List</title>
  <style>
    /* Basic reset */
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.4;background:#f5f7fb;color:#111;padding:24px;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .app{width:100%;max-width:560px;background:#fff;border-radius:10px;box-shadow:0 6px 24px rgba(19,23,34,0.08);padding:20px}
    h1{font-size:20px;margin-bottom:12px}
    .header{display:flex;gap:8px;margin-bottom:12px}
    .new-task{flex:1;padding:10px 12px;border:1px solid #e3e7ef;border-radius:8px;font-size:14px}
    .add-task{padding:10px 14px;border:none;background:#2563eb;color:#fff;border-radius:8px;cursor:pointer}
    .add-task:active{transform:translateY(1px)}
    .task-list{list-style:none;max-height:320px;overflow:auto;padding-right:6px}
    .task-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid #f0f3f8}
    .task-left{display:flex;gap:12px;align-items:center}
    .check{width:20px;height:20px;border-radius:6px;border:2px solid #cbd5e1;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;background:transparent}
    .check.checked{background:#10b981;border-color:#10b981;color:#fff}
    .check.checked::after{content:"✓";font-size:12px}
    .task-text{font-size:14px;max-width:420px;word-break:break-word}
    .task-text.completed{opacity:0.6;text-decoration:line-through}
    .delete-btn{background:transparent;border:none;color:#ef4444;font-size:18px;cursor:pointer;padding:6px}
    .footer{display:flex;align-items:center;justify-content:space-between;margin-top:12px;gap:12px;flex-wrap:wrap}
    .task-count{color:#475569;font-size:13px}
    .filters{display:flex;gap:6px}
    .filter-btn{padding:6px 10px;border-radius:8px;border:1px solid transparent;background:transparent;cursor:pointer;font-size:13px}
    .filter-btn.active{background:#eef2ff;border-color:#c7d2fe;color:#3730a3}
    .clear-completed{background:transparent;border:none;color:#64748b;cursor:pointer;font-size:13px}
    @media (max-width:420px){.task-text{max-width:180px}}
  </style>
</head>
<body>
  <main class="app" id="app" aria-labelledby="app-title">
    <h1 id="app-title">Todo List</h1>

    <div class="header">
      <input id="taskInput" class="new-task" placeholder="Add a new task..." aria-label="New task">
      <button id="addBtn" class="add-task" aria-label="Add task">Add</button>
    </div>

    <ul id="taskList" class="task-list" aria-live="polite"></ul>

    <div class="footer">
      <div id="count" class="task-count">0 items left</div>
      <div class="filters" role="tablist" aria-label="Filter tasks">
        <button class="filter-btn active" data-filter="all" role="tab" aria-selected="true">All</button>
        <button class="filter-btn" data-filter="active" role="tab">Active</button>
        <button class="filter-btn" data-filter="completed" role="tab">Completed</button>
      </div>
      <button id="clearCompleted" class="clear-completed">Clear Completed</button>
    </div>
  </main>

  <script>
    (function () {
      const taskInput = document.getElementById('taskInput');
      const addBtn = document.getElementById('addBtn');
      const taskList = document.getElementById('taskList');
      const countEl = document.getElementById('count');
      const clearCompletedBtn = document.getElementById('clearCompleted');
      const filterBtns = Array.from(document.querySelectorAll('.filter-btn'));
      const STORAGE_KEY = 'todo.tasks.v1';

      let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      let filter = 'all';

      function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

      function render(){
        taskList.innerHTML = '';
        const filtered = tasks.filter(t => filter === 'all' ? true : (filter === 'active' ? !t.completed : t.completed));
        if(filtered.length === 0){
          const li = document.createElement('li');
          li.className = 'task-item';
          li.style.justifyContent = 'center';
          li.style.color = '#94a3b8';
          li.textContent = 'No tasks';
          taskList.appendChild(li);
        } else {
          filtered.forEach(task => {
            const li = document.createElement('li');
            li.className = 'task-item';
            li.innerHTML = `
              <div class="task-left">
                <button class="check ${task.completed ? 'checked' : ''}" data-id="${task.id}" title="Toggle"></button>
                <div class="task-text ${task.completed ? 'completed' : ''}">${escapeHtml(task.text)}</div>
              </div>
              <div>
                <button class="delete-btn" data-id="${task.id}" title="Delete">×</button>
              </div>
            `;
            taskList.appendChild(li);
          });
        }

        const remaining = tasks.filter(t => !t.completed).length;
        countEl.textContent = `${remaining} item${remaining !== 1 ? 's' : ''} left`;
      }

      function addTask(text){
        const trimmed = (text || '').trim();
        if(!trimmed) return;
        tasks.unshift({ id: Date.now().toString(36) + Math.random().toString(36).slice(2,7), text: trimmed, completed: false });
        save(); render(); taskInput.value = ''; taskInput.focus();
      }

      function toggleTask(id){
        const t = tasks.find(x => x.id === id); if(!t) return;
        t.completed = !t.completed; save(); render();
      }

      function deleteTask(id){
        tasks = tasks.filter(x => x.id !== id); save(); render();
      }

      function clearCompleted(){
        tasks = tasks.filter(x => !x.completed); save(); render();
      }

      function setFilter(f){
        filter = f;
        filterBtns.forEach(b => {
          b.classList.toggle('active', b.dataset.filter === f);
          b.setAttribute('aria-selected', b.dataset.filter === f ? 'true' : 'false');
        });
        render();
      }

      taskList.addEventListener('click', (e) => {
        const id = e.target.dataset.id;
        if(!id) return;
        if(e.target.classList.contains('check')) toggleTask(id);
        if(e.target.classList.contains('delete-btn')) deleteTask(id);
      });

      addBtn.addEventListener('click', () => addTask(taskInput.value));
      taskInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') addTask(taskInput.value); });

      clearCompletedBtn.addEventListener('click', clearCompleted);
      filterBtns.forEach(btn => btn.addEventListener('click', () => setFilter(btn.dataset.filter)));

      // initial render
      render();
    })();
  </script>
</body>
</html>
